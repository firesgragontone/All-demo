

小文件系统？ 
你就可以说，我们公司有几块业务，如果业务是商城，就说要存很多图片文件，如果业务是b端就说要存很多合同、资料等文件。如果业务是支付，就说要保存对账单、图片、文档等。反正自己想一下自己本身在公司是怎么保存这些文件的，一般小的公司就是存在机器上，或者nas上，好一点的就是保存在阿里云oss上。
反正无论实际情况如何，都说文件都是用阿里云的oss的，然后阿里云的oss的话，费用标准是：
使用标准存储 1TB的文件，然后访问频率比较低一点，需要500块钱一个月，如果频率高一点，可能700-800块钱一天。
然后我们说的时候，就可以夸大一点，比如说公司存储了100TB的文件，然后访问频率也高点，每个月10万块钱的阿里云oss费用，一年就是100万。 当然了这个也不能瞎说，如果你公司是那种小公司，比如就成立了1~3年，然后人没多少个，说100TB就有点夸张了，可以适当夸张一点。 

所以最终说起来，这块背景的话，总得来说就是因为公司存储文件成本很高，所以自研，每年能省不少钱，然后也能保证数据的安全性。
完了以后，讲完小文件系统的开发背景之后，就说你当时是被任命为主导开发的，就可以说，对比了业界的文件存储系统，比如oss、fastdfs、hsdf的之后，知道了一些机制之后，采用参考的方式做。
首先说一下小文件系统的架构，比如我们文件系统的拓扑结构是 namenode、datanode、backupnode几种节点，如果你学过hdfs的源码或者比较有信心，就可以说这块我们是参考hdfs来做的，说一下各个节点是怎么用的，如果你没学过hdfs的源码，就不要扯到这边。讲一下datanode节点是启动的时候，是要往namenode注册的，然后namenode节点主要是负责元数据的管理、datanode节点主要是负责保存文件的
那讲完这些基础数据之后，可能有些面试管连什么是元数据都不懂。那你就可以跟他解释，啊元数据就是描述数据的数据啊，你让他想象一下自己的电脑，你在电脑中创建了一个文件，操作系统是不是会记录下来你机器创建了一个文件夹这个信息，然后操作系统会记录你有哪些目录，有哪些文件。这些就是元数据，它是描述操作系统用户数据的数据。或者这个不好理解，可以举另一个例子，比如我们用的mysql对吧，那建表语句就是元数据，每一列字段就是元数据，然后我们insert进去的就是数据，然后元数据是用来描述数据的数据。这样让他理解一下。
那接下来就是讲一下小文件的核心流程，说白了，就是创建文件的时候，元数据的存储，你就说我们这块是参考的hdfs的 editlog + 双缓冲区来实现高并发的。
到了这里就要考验你的表述能力了，你可以想象怎么去表达出editlog和双缓冲这个机制，最好先画个图，表示双缓冲区，然后边画边说，然后其实就是首先说一下我们元数据其实就是一条一条的日志，这些日志记录着你做了什么操作，每条日志有个递增的id，然后我们创建文件的时候，其实是将日志往一个缓冲区写数据，所以这个过程很快的，内存操作，然后等到缓冲区，满了，就会多个线程尝试加锁，那只有一个线程成功了，完了以后呢，这个线程就会去刷磁盘，那这个线程取到刷磁盘的资格之后，会交换缓冲区，让其他线程先写另一快没满的缓冲区，真正刷磁盘的操作也是不加锁的，所以不会阻塞其他线程。 



那总的一个过程来说，就大部分线程都是很快的，因为都是内存操作，然后就是满了缓冲区以后，有一个线程可能会慢一点，因为他要去刷磁盘，但是这个不影响，对外整个系统的吞吐量是很大的。
那等上面这一套搞完了之后，那其实能讲半个小时了，这个时候可能面试官就没有兴趣了，如果面试官还有兴趣继续听你讲，那你就可以继续讲backupnode备份机制、fsiamge、checkpoint这些机制，后面还可以说主备切换，多namenode联邦架构+元数据分片+动态扩容机制(当然前提是你能吃透了)。 
完了以后，可以来一个总结收尾，说这一套是我们xx云盘系统最核心的文件存储的功能，然后我们在这个系统上层包装了一些springboot的工程，实现了一些云盘，共享等功能。
那基本上小文件这一套就是这么讲，如果这一套都能讲下来，能表达得很清晰，面试官也能听懂，那基本上对于面试官来说，是印象很深刻的，会有较大概率通过面试。